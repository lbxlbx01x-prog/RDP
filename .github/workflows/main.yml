name: Windows

on: 
  workflow_dispatch:

jobs:
  windows-session:
    runs-on: windows-latest
    
    steps:
      # 1. ØªÙ†Ø²ÙŠÙ„ ÙˆØªØ³Ø·ÙŠØ¨ Tailscale
      - name: â¬‡ï¸ Install Tailscale
        run: |
          Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
          choco install tailscale -y

      # 2. Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¹ Tailscale
      - name: ğŸ”Œ Connect to Tailscale
        run: |
          & 'C:\Program Files\Tailscale\tailscale.exe' up --authkey="${{ secrets.TAILSCALE_AUTH_KEY }}" --hostname="github-windows-server" --unattended

      # 3. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙŠÙˆØ²Ø± (Ø§Ù„Ù…Ù‡Ù… Ù‡Ù†Ø§ Ù‡Ùˆ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø§Ù„Ù‚ÙˆÙŠ)
      - name: ğŸ› ï¸ Setup User & Enable RDP
        run: |
          # Ø¶Ø±ÙˆØ±ÙŠ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙŠÙƒÙˆÙ† Ù…Ø®Ù„Ø· (ÙƒØ¨Ø§Ø±ØŒ ØµØºØ§Ø±ØŒ Ø±Ù…ÙˆØ²) ÙˆØ¥Ù„Ø§ Ù…ØºÙŠØ®Ø¯Ù…Ø´
          net user runneradmin "Maroc@2026!"
          
          # ØªÙØ¹ÙŠÙ„ RDP
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          
          # ÙØªØ­ Ø§Ù„Ø¨ÙˆØ± ÙÙ€ Firewall
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          Write-Host "RDP Setup Complete."

      # 4. Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
      - name: â„¹ï¸ Connection Info
        run: |
          Write-Host "=========================================="
          Write-Host "USERNAME: runneradmin"
          Write-Host "PASSWORD: Maroc@2026!"
          Write-Host "=========================================="

      # 5. Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ (6 Ø³ÙˆØ§ÙŠØ¹)
      - name: â³ Keep Alive (6 Hours)
        run: |
          Write-Host "Session is running..."
          Start-Sleep -Seconds 21600
