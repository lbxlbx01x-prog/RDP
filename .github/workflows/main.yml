name: Windows

on: 
  workflow_dispatch:

jobs:
  windows-session:
    runs-on: windows-latest
    
    steps:
      # 1. Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…Ø¹ Tailscale
      - name: ğŸ”Œ Connect to Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTH_KEY }}
          hostname: github-windows-server

      # 2. ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ÙˆÙØªØ­ RDP
      - name: ğŸ› ï¸ Setup User & Enable RDP
        run: |
          # Ù‡Ù†Ø§ ÙƒÙ†Ø­Ø¯Ø¯Ùˆ Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù„Ù„ÙŠÙˆØ²Ø± Ø§Ù„Ø£Ø¯Ù…ÙŠÙ† (runneradmin)
          # Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ø¯Ø±Øª Ù„ÙŠÙƒ ÙÙŠÙ‡ Ø­Ø±ÙˆÙ ÙƒØ¨Ø§Ø± ÙˆØµØºØ§Ø± ÙˆØ±Ù…ÙˆØ² Ø­ÙŠØª ÙˆÙŠÙ†Ø¯ÙˆØ² ÙƒÙŠØ¨ØºÙŠ Strong Password
          net user runneradmin "Maroc@2024!" 
          
          # ØªÙØ¹ÙŠÙ„ RDP ÙØ§Ù„Ø±ÙŠØ¬ÙŠØ³ØªØ±ÙŠ
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -name "fDenyTSConnections" -value 0
          
          # ÙØªØ­ Ø§Ù„Ø¨ÙˆØ± ÙÙ€ Firewall Ø¨Ø§Ø´ ÙŠØ¯ÙˆØ²
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          
          Write-Host "RDP Setup Complete."

      # 3. Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙƒÙˆÙ†ÙŠÙƒØ³ÙŠÙˆÙ†
      - name: â„¹ï¸ Connection Info
        run: |
          Write-Host "=========================================="
          Write-Host "Connect via Tailscale IP"
          Write-Host "Username: runneradmin"
          Write-Host "Password: Maroc@2024!"
          Write-Host "=========================================="

      # 4. Ø§Ù„Ø¨Ù‚Ø§Ø¡ Ù‚ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ (6 Ø³ÙˆØ§ÙŠØ¹)
      - name: â³ Keep Alive (6 Hours)
        run: |
          Write-Host "Session is running..."
          Start-Sleep -Seconds 21600
